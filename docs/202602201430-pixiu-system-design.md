# 貔貅 (Pixiu) 智能基金交易分析系统 — 技术设计文档

> 日期：2026-02-20 14:30
> 作者：Claude Code
> 状态：已实现

## 背景与目标

构建一个面向中国公募基金（支付宝可购买）的智能交易分析系统。系统自动分析市场数据，生成带有详细理由的买卖建议，并持续跟踪组合表现。

核心约束：
- 起始资金 10,000 RMB
- "可以少赚，不能多亏" — 下行保护优先
- 系统只负责分析和建议，最终交易由用户决策

## 方案设计

### 架构

```
CLI (main.py)
  ├── 数据层 (data/) — AKShare API 封装，缓存，标准化
  ├── 分析引擎 (analysis/) — 技术指标，基金评分，市场状态，板块轮动
  ├── 策略引擎 (strategy/) — 趋势跟踪，均值回归，动量，组合构建
  ├── 风险管理 (risk/) — 仓位计算(半凯利)，回撤监控，费用计算
  ├── 记忆系统 (memory/) — SQLite 存储，交易日志，上下文构建
  └── 报告生成 (report/) — Markdown 报告，模板系统
```

### 数据流

1. 每日收盘后获取最新数据 (AKShare → SQLite)
2. 计算技术指标 + 检测市场状态
3. 三策略加权生成综合信号
4. 风险管理过滤 + 仓位计算
5. 生成 Markdown 报告 + 记录到数据库

### 策略加权

根据市场状态动态分配策略权重：

| 市场状态 | 趋势跟踪 | 动量 | 均值回归 | 权益仓位 |
|----------|----------|------|----------|----------|
| 强牛市 | 50% | 35% | 15% | 85% |
| 弱牛市 | 40% | 30% | 30% | 65% |
| 震荡 | 20% | 20% | 60% | 45% |
| 弱熊市 | 30% | 10% | 60% | 30% |
| 强熊市 | 40% | 5% | 55% | 10% |

## 影响范围

- 独立项目，不影响其他服务
- 依赖外部数据源 AKShare（东方财富等）

## 风险评估

- 数据源风险：AKShare 接口可能变更 → 封装层隔离
- 策略风险：公募基金流动性好，风险有限 → 严格止损 (8% 单基金, 10% 组合)
- 收益预期：用户期望激进(月25%)，实际公募年化 10-15%，需管理预期

## 实现计划

已完成全部 5 个阶段：

1. 基础骨架与数据层 — 完成
2. 分析引擎与基金筛选 — 完成
3. 策略引擎与风险管理 — 完成
4. 报告系统与记忆 — 完成
5. 完整 CLI 与日常流程 — 完成
